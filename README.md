## Osteon API Documentation
# Evident Integration Proposal

Last Updated: 22nd November 2022

---

## Table of Contents

  * [Authentication](#authentication)
  * [Request / Order Object Schema](#request---order-object-schema)
  * [Comments Object Schema](#comments-object-schema)
  * [Listing Pending Requests](#listing-pending-requests)
  * [Viewing Request Details](#viewing-request-details)
  * [Accepting a Request](#accepting-a-request)
  * [Uploading Design Files](#uploading-design-files)
  * [Adding Comments / Notes to a Request](#adding-comments---notes-to-a-request)
  * [Completing a Request](#completing-a-request)

---

## Authentication

The Osteon API uses secret keys to authenticate requests. Your authentication key will be provided securely to you by the Osteon Software Team.

Your API keys carry many privileges, so be sure to keep them secure. Do not share API keys in any publicly accessible areas such as GitHub, client-side code, and so forth.

Authentication to the API is performed via bearer auth, use the HTTP header:

```http
OEPAuth: cf844884dbf51b907240d1d66860f9263b76cbcb
```

All API requests must be made over HTTPS. Calls made over plain HTTP will fail. API requests without authentication will also fail.

---

## Request / Order Object Schema

Much of the request object has been modelled on the Evident API case object.

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `Rush` | `boolean` | As per Evident API. |
| `RefId` | `string` | As per Evident API. |
| `Units` | `string` | As per Evident API. |
| `DesignTypes` | `string[]` | As per Evident API. |
| `Instructions` | `string` | As per Evident API. |
| `ScannerType` | `string` | As per Evident API. |
| `RequestId` | `int` | Osteon's reference for this request - **used in URIs**. |
| `EvidentId` | `string` | Evident's reference for this request. |
| `RequestedAt` | `string` | ISO8601 timestamp of the time the request was generated by Osteon. |
| `RedoRequested` | `boolean` | Denotes if the request has been marked for redo. |
| `RedoRequestedAt` | `string` | ISO8601 timestamp of the time the redo was generated by Osteon. |
| `CompletedAt` | `string` | ISO8601 timestamp of the time the request was marked as completed by Evident. |
| `AcceptedAt` | `string` | ISO8601 timestamp of the time the request was marked as accepted by Evident. |
| `RedoAcceptedAt` | `string` | ISO8601 timestamp of the time the redo was marked as accepted by Evident. |
| `RedoNotes` | `string` | Notes describing the reason for redo (from Osteon). |
| `Files` | `string[]` | List of URIs for files supplied by Osteon to complete this request. |
| `Comments` | `object[]` | List of comments and notes between Osteon and Evident regarding this request. |

---

## Comments Object Schema

| Attribute | Type | Description |
| :--- | :--- | :--- |
| `MessageID` | `string` | UUID for the specific comment / note. |
| `Message` | `string` | The message content. |
| `CreatedAt` | `string` | ISO8601 timestamp of the time the comment was created. |
| `Direction` | `string` | Either `INBOUND` or `OUTBOUND`. Outbound if from Osteon to Evident, inbound is Evident to Osteon. |
| `From` | `string` | The name of the author. |

---

## Listing Pending Requests

Returns a list of requests for Evident to process. This includes new Evident orders along with redo requests.

Once a request has been accepted, it will no longer appear in this list. You will need to implement a system to keep track of the `RequestId` for further processing.

### Endpoint

```http
GET /api/v2/evident/
```

### Content Type

```http
application/json
```

### HTTP Responses

| Status Code | Description |
| :--- | :--- |
| 200 | `OK` |

### Example Success Response Body

```json
[
	{
		"RefId": "39432-A",
		"RequestId": 3241,
		"EvidentId": "",
		"RequestedAt": "2022-11-22T14:34:08.233425",
		"RedoRequested": false,
		"RedoRequestedAt": null,
		"CompletedAt": null
	}
]
```

---

## Viewing Request Details

Shows all request information, files and associated comments (notes).

### Endpoint

```http
GET /api/v2/evident/:RequestId/
```

### Content Type
```http
application/json
```

### HTTP Responses

| Status Code | Description |
| :--- | :--- |
| 200 | `OK` |
| 404 | `Not Found - The request does not exist` |

### Example Success Response Body

```json
{
	"Rush": false,
	"RefId": "39432-A",
	"Units": null,
	"Position": "anterior",
	"DesignType": [
		"1044",
		"1100"
	],
	"Instruction": "### REFERENCE NUMBER: 39432-A ###\n\nFull Arch All on X:\n\nThis is a test request.",
	"ScannerType": "3Shape",
	"RequestId": 3241,
	"EvidentId": "",
	"RequestedAt": "2022-11-22T14:34:08.233425",
	"RedoRequested": false,
	"RedoRequestedAt": null,
	"CompletedAt": null,
	"AcceptedAt": null,
	"RedoAcceptedAt": null,
	"RedoNotes": null,
	"Files": [
		"https://storage.googleapis.com/oep-development/de362d_6541d7_UpperJaw.ply"
	],
	"Comments": [
		{
			"MessageID": "410af9c2-3ef6-47c0-9069-49264c46ad60",
			"Message": "This is a test request.",
			"CreatedAt": "2022-11-22T14:34:07.777611",
			"Direction": "OUTBOUND",
			"From": "Jeremy"
		}
	]
}
```

---

## Accepting a Request

Before a request can be actioned, it must be accepted by Evident. When accepting this request, the payload must include Evident's reference number `EvidentId`.

### Endpoint

```http
POST /api/v2/evident/:RequestId/accept/
```

### Content Type

```http
application/json
```

### Request Body Example

```json
{
  "EvidentId": "12345678"
}
```

### HTTP Responses

| Status Code | Description |
| :--- | :--- |
| 200 | `OK` |
| 404 | `Not Found - The request does not exist` |
| 400 | `Bad Request - See payload for more details` |

### Error Messages in Response Body

| Message | Description |
| :--- | :--- |
| `Missing EvidentId.` | Evident's reference number for this request has not been supplied. |
| `Request already completed.` | Request has already been marked as completed by Evident. |
| `Request already accepted.` | Request has already been marked as accepted by Evident. |

### Example Success Response Body

```json
{
	"Rush": false,
	"RefId": "39432-A",
	"Units": null,
	"Position": "anterior",
	"DesignType": [
		"1044",
		"1100"
	],
	"Instruction": "### REFERENCE NUMBER: 39432-A ###\n\nFull Arch All on X:\n\nThis is a test request.",
	"ScannerType": "3Shape",
	"RequestId": 3241,
	"EvidentId": "12345678",
	"RequestedAt": "2022-11-22T14:34:08.233425",
	"RedoRequested": false,
	"RedoRequestedAt": null,
	"CompletedAt": null,
	"AcceptedAt": "2022-11-22T14:49:05.508610",
	"RedoAcceptedAt": null,
	"RedoNotes": null,
	"Files": [
		"https://storage.googleapis.com/oep-development/de362d_6541d7_UpperJaw.ply"
	],
	"Comments": [
		{
			"MessageID": "410af9c2-3ef6-47c0-9069-49264c46ad60",
			"Message": "This is a test request.",
			"CreatedAt": "2022-11-22T14:34:07.777611",
			"Direction": "OUTBOUND",
			"From": "Jeremy"
		}
	]
}
```

---

## Uploading Design Files

Design files can be uploaded using the following endpoint.

### Endpoint

```http
POST /api/v2/evident/:RequestId/upload/
```

### Content Type
```http
multipart/form-data
```

### Request Body

| Field Name | Description |
| :--- | :--- |
| `DesignFiles` | Files to be uploaded. Can be single or multiple.

### HTTP Responses

| Status Code | Description |
| :--- | :--- |
| 200 | `OK` |
| 404 | `Not Found - The request does not exist` |
| 400 | `Bad Request - See payload for more details` |

### Error Messages in Response Body

| Message | Description |
| :--- | :--- |
| `Missing DesignFiles.` | No design files have been supplied in the request. |
| `Request has been completed.` | Request has already been marked as completed by Evident. |
| `Request has not been accepted.` | Request has not been marked as accepted by Evident. |

### Example Success Response Body

```json
{
	"Rush": false,
	"RefId": "39432-A",
	"Units": null,
	"Position": "anterior",
	"DesignType": [
		"1044",
		"1100"
	],
	"Instruction": "### REFERENCE NUMBER: 39432-A ###\n\nFull Arch All on X:\n\nThis is a test request.",
	"ScannerType": "3Shape",
	"RequestId": 3241,
	"EvidentId": "12345678",
	"RequestedAt": "2022-11-22T14:34:08.233425",
	"RedoRequested": false,
	"RedoRequestedAt": null,
	"CompletedAt": null,
	"AcceptedAt": "2022-11-22T14:49:05.508610",
	"RedoAcceptedAt": null,
	"RedoNotes": null,
	"Files": [
		"https://storage.googleapis.com/oep-development/de362d_6541d7_UpperJaw.ply"
	],
	"Comments": [
		{
			"MessageID": "410af9c2-3ef6-47c0-9069-49264c46ad60",
			"Message": "This is a test request.",
			"CreatedAt": "2022-11-22T14:34:07.777611",
			"Direction": "OUTBOUND",
			"From": "Jeremy"
		}
	]
}
```

---

## Adding Comments / Notes to a Request

Notes can be read from the response payload of `/api/v2/evident/:RequestId/`.

If you need to add a note to a request, or send a message to Osteon, use the following endpoint.

### Endpoint
```http
POST /api/v2/evident/:RequestId/comment/
```

### Content Type
```http
application/json
```

### Request Body Example

```json
{
  "Message": "This is a test message from Evident."
}
```

### HTTP Responses

| Status Code | Description |
| :--- | :--- |
| 200 | `OK` |
| 404 | `Not Found - The request does not exist` |
| 400 | `Bad Request - See payload for more details` |

### Error Messages in Response Body

| Message | Description |
| :--- | :--- |
| `Missing Message.` | No message was supplied in the request. |
| `Request has been completed.` | Request has already been marked as completed by Evident. |
| `Request has not been accepted.` | Request has not been marked as accepted by Evident. |

### Example Success Response Body

```json
{
	"Rush": false,
	"RefId": "39432-A",
	"Units": null,
	"Position": "anterior",
	"DesignType": [
		"1044",
		"1100"
	],
	"Instruction": "### REFERENCE NUMBER: 39432-A ###\n\nFull Arch All on X:\n\nThis is a test request.",
	"ScannerType": "3Shape",
	"RequestId": 3241,
	"EvidentId": "12345678",
	"RequestedAt": "2022-11-22T14:34:08.233425",
	"RedoRequested": false,
	"RedoRequestedAt": null,
	"CompletedAt": null,
	"AcceptedAt": "2022-11-22T14:49:05.508610",
	"RedoAcceptedAt": null,
	"RedoNotes": null,
	"Files": [
		"https://storage.googleapis.com/oep-development/de362d_6541d7_UpperJaw.ply"
	],
	"Comments": [
		{
			"MessageID": "b1e485ad-f9f9-47d0-9736-3060c67c5e07",
			"Message": "This is a test message from Evident.",
			"CreatedAt": "2022-11-22T15:11:28.108820",
			"Direction": "INBOUND",
			"From": "Evident"
		},
		{
			"MessageID": "410af9c2-3ef6-47c0-9069-49264c46ad60",
			"Message": "This is a test request.",
			"CreatedAt": "2022-11-22T14:34:07.777611",
			"Direction": "OUTBOUND",
			"From": "Jeremy"
		}
	]
}
```

---

## Completing a Request

Once a request has been completed by Evident, it must be marked as such via the Osteon API.

### Endpoint
```http
POST /api/v2/evident/:RequestId/complete/
```

### Content Type
```http
application/json
```

### HTTP Responses

| Status Code | Description |
| :--- | :--- |
| 200 | `OK` |
| 404 | `Not Found - The request does not exist` |
| 400 | `Bad Request - See payload for more details` |

### Error Messages in Response Body

| Message | Description |
| :--- | :--- |
| `Missing Message.` | No message was supplied in the request. |
| `Request has already been completed` | Request has already been marked as completed by Evident. |
| `Request has not been accepted.` | Request has not been marked as accepted by Evident. |

### Example Success Response Body

```json
{
	"Rush": false,
	"RefId": "39432-A",
	"Units": null,
	"Position": "anterior",
	"DesignType": [
		"1044",
		"1100"
	],
	"Instruction": "### REFERENCE NUMBER: 39432-A ###\n\nFull Arch All on X:\n\nThis is a test request.",
	"ScannerType": "3Shape",
	"RequestId": 3241,
	"EvidentId": "12345678",
	"RequestedAt": "2022-11-22T14:34:08.233425",
	"RedoRequested": false,
	"RedoRequestedAt": null,
	"CompletedAt": "2022-11-22T15:14:07.722243",
	"AcceptedAt": "2022-11-22T14:49:05.508610",
	"RedoAcceptedAt": null,
	"RedoNotes": null,
	"Files": [
		"https://storage.googleapis.com/oep-development/de362d_6541d7_UpperJaw.ply"
	],
	"Comments": [
		{
			"MessageID": "b1e485ad-f9f9-47d0-9736-3060c67c5e07",
			"Message": "This is a test message from Evident.",
			"CreatedAt": "2022-11-22T15:11:28.108820",
			"Direction": "INBOUND",
			"From": "Evident"
		},
		{
			"MessageID": "410af9c2-3ef6-47c0-9069-49264c46ad60",
			"Message": "This is a test request.",
			"CreatedAt": "2022-11-22T14:34:07.777611",
			"Direction": "OUTBOUND",
			"From": "Jeremy"
		}
	]
}
```
